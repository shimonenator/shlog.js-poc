<!DOCTYPE html>
<!-- <html manifest="shlog.appcache"> -->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Shlog.js</title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/localforage/1.2.1/localforage.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
    <script src="libs/fetch.js"></script>
    <script src="libs/helpers.js"></script>
    <script src="libs/router.js"></script>
    <script>
    var Shlog = {};
    fetch('/config.json')
        .then(function(response) {
            return response.json();
        }).then(function(json) {
            Shlog.config = json; // Shlog.config
        }).catch(function(ex) {
            console.error('Fail: ', ex)
        });

    fetch('/posts.json')
        .then(function(response) {
            return response.json();
        }).then(function(posts) {
            Shlog.posts = posts; // Shlog.posts
            Router
                .add(/about/, function() {
                    alert("jes");
                })
            for (var key in Shlog.posts) {
                Router.add("/" + key + "/", function() {
                    console.warn("TEST");
                    fetch(Shlog.posts[Router.getFragment()].content)
                        .then(function(response) {
                            return response.text();
                        })
                        .then(function(text) {
                            document.getElementsByTagName('post')[0].innerHTML = marked(text);
                        })
                }).listen();
                // console.log(key, Shlog.posts[key].author);
            }
        }).catch(function(ex) {
            console.log('parser error', ex);
        });

    Router.config({
        mode: 'history',
        root: '/'
    });

    // Routes
    </script>
</head>

<body>

    <script>
    // localforage.setItem('my array', "proba", function(err, value) {
    //     console.log(value);
    // });
    // var userInfo = jsonp("http://ajaxhttpheaders2.appspot.com/", function(data) {
    //     console.log(data);
    // });
    </script>

    <h1><img src="assets/shlog.png" alt="Shlog.js"></h1>
    <post></post>
</body>

</html>
